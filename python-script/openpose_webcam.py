# From Python
# It requires OpenCV installed for Python
import sys
import cv2
import os
from pose_match import *
from sys import platform

bad = [[1142.3232421875, 728.1851196289062, 0.8426504135131836], [1198.7120361328125, 1119.944580078125, 0.9185787439346313], [918.5460815429688, 1142.4290771484375, 0.8032334446907043], [862.5579223632812, 1646.419677734375, 0.8447969555854797], [985.6318359375, 2083.226806640625, 0.8510572910308838], [1489.4921875, 1108.5941162109375, 0.8460644483566284], [1736.0880126953125, 1489.497314453125, 0.7237370014190674], [1881.57080078125, 1825.55126953125, 0.355158269405365], [1523.1553955078125, 1758.117919921875, 0.7476696372032166], [1366.637451171875, 1825.4892578125, 0.7456164956092834], [1937.7171630859375, 2374.599609375, 0.853018045425415], [1769.8145751953125, 3258.16748046875, 0.7223650217056274], [1680.029296875, 1702.40771484375, 0.7091360688209534], [2385.72119140625, 2082.7783203125, 0.8433859348297119], [2161.330322265625, 2788.30224609375, 0.746890127658844], [1053.02197265625, 694.7454833984375, 0.8389255404472351], [1197.8564453125, 661.05517578125, 0.9435703754425049], [1008.19580078125, 839.873779296875, 0.9256584048271179], [1277.0513916015625, 728.1030883789062, 0.7196429371833801], [2463.7509765625, 2844.2119140625, 0.721824586391449], [2452.483154296875, 2810.9462890625, 0.7185602784156799], [2082.677001953125, 2833.320068359375, 0.7669593691825867], [1859.0816650390625, 3617.022705078125, 0.6371602416038513], [1747.4986572265625, 3572.164306640625, 0.5955163240432739], [1735.466796875, 3269.856201171875, 0.6314183473587036]]
bad = np.array(bad)

good = [[1568.196044921875, 1176.2359619140625, 0.8874599933624268], [1567.66650390625, 1489.7501220703125, 0.9207262992858887], [1310.4051513671875, 1478.8494873046875, 0.8589267730712891], [1221.1370849609375, 1858.9344482421875, 0.8256404995918274], [1466.99267578125, 2127.752197265625, 0.8749884963035583], [1825.4564208984375, 1500.8265380859375, 0.8622338175773621], [1914.64013671875, 1847.9443359375, 0.8729796409606934], [1814.080810546875, 2116.6240234375, 0.8582468628883362], [1579.111572265625, 2138.974609375, 0.7971763610839844], [1399.9945068359375, 2150.250732421875, 0.7516412734985352], [1378.10986328125, 2654.06103515625, 0.874354362487793], [1466.5958251953125, 3101.721435546875, 0.8760700821876526], [1747.730224609375, 2127.9482421875, 0.7920464873313904], [2082.88037109375, 2586.9619140625, 0.8460466265678406], [1915.2581787109375, 3057.208740234375, 0.8779643177986145], [1523.197265625, 1119.864013671875, 0.889336347579956], [1635.253662109375, 1119.6722412109375, 0.923917293548584], [1444.966064453125, 1164.904541015625, 0.8516204953193665], [1702.29052734375, 1153.7130126953125, 0.8362717628479004], [2004.6907958984375, 3314.58251953125, 0.7873661518096924], [2082.97900390625, 3269.65576171875, 0.7607110738754272], [1836.514404296875, 3079.11865234375, 0.8531792163848877], [1321.7828369140625, 3359.359130859375, 0.7732552289962769], [1276.924560546875, 3314.767333984375, 0.7223288416862488], [1500.656005859375, 3146.5595703125, 0.8295161724090576]]
good = np.array(good)

# Remember to add your installation path here
# Option a
dir_path = os.path.dirname(os.path.realpath(__file__))
if platform == "win32": sys.path.append(dir_path + '/../openpose/build/python/openpose/');
else: sys.path.append('../openpose/build/python');
# Option b
# If you run `make install` (default path is `/usr/local/python` for Ubuntu), you can also access the OpenPose/python module from there. This will install OpenPose and the python library at your desired installation path. Ensure that this is in your python path in order to use it.
# sys.path.append('/usr/local/python')

# Parameters for OpenPose. Take a look at C++ OpenPose example for meaning of components. Ensure all below are filled
try:
    from openpose import *
except:
    raise Exception('Error: OpenPose library could not be found. Did you enable `BUILD_PYTHON` in CMake and have this Python script in the right folder?')

params = dict()
params["logging_level"] = 3
params["output_resolution"] = "-1x-1"
params["net_resolution"] = "-1x368"
params["model_pose"] = "BODY_25"
params["alpha_pose"] = 0.6
params["scale_gap"] = 0.3
params["scale_number"] = 1
params["render_threshold"] = 0.05
# If GPU version is built, and multiple GPUs are available, set the ID here
params["num_gpu_start"] = 0
params["disable_blending"] = False
# Ensure you point to the correct path where models are located
params["default_model_folder"] = dir_path + "/../../../models/"
        
openpose = OpenPose(params)

stream = cv2.VideoCapture(0)

while 1:
    ret,img = stream.read();
    # Output keypoints and the image with the human skeleton blended on it
    keypoints, output_image = openpose.forward(img, True)
    # Print the human pose keypoints, i.e., a [#people x #keypoints x 3]-dimensional numpy object with the keypoints of all the people on that image
    # print(keypoints)

    # Display the image
    cv2.imshow("output", output_image)
    cv2.waitKey(1000)
    if (keypoints.shape[0] > 0 and keypoints[0].shape == a.shape):
        (b1, b2) = compare(keypoints[0], bad)
        (g1, g2) = compare(keypoints[0], good)
        if (12 < g1 + g2):
            print "bad"
        else:
            print "good"

stream.release()